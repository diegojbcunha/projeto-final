<div class="paths-container">
  <div class="header-section">
    <h2 class="title">Recommended Learning Paths</h2>
    <p class="subtitle" *ngIf="currentUser?.department">Personalized for {{ currentUser?.department }} professionals</p>

    <div class="actions-bar" *ngIf="isAdmin">
      <button class="add-btn" (click)="addNew()">+ Add New Path</button>
    </div>
  </div>

  <!-- Info message for personalized recommendations -->
  <div class="info-message" *ngIf="currentUser?.department">
    <p>These learning paths are recommended based on your role as a {{ currentUser?.department }} professional.</p>
  </div>

  <!-- Learning Paths Grid -->
  <div class="paths-grid">
    <app-learning-path-card
      *ngFor="let path of paths(); trackBy: trackById"
      [learningPath]="path"
      [isAdmin]="isAdmin"
      (editPath)="editPath($event)"
      (deletePath)="deletePath($event)">
    </app-learning-path-card>
  </div>

  <!-- Message when no paths are available -->
  <div class="no-paths-message" *ngIf="paths().length === 0">
    <p>No recommended learning paths available for your department yet.</p>
    <p *ngIf="isAdmin">As an administrator, you can create new learning paths.</p>
  </div>

  <div *ngIf="showForm()" class="form-card" (click)="onModalClick($event)">
    <div class="form-content">
      <div class="form-header">
        <h3>{{ editMode() ? 'Edit Learning Path' : 'Add New Learning Path' }}</h3>
        <button type="button" class="close-modal" (click)="cancel()" aria-label="Close modal">
          Ã—
        </button>
      </div>

      <form #pathForm="ngForm" (ngSubmit)="savePath(pathForm)">
        <input
          type="text"
          [(ngModel)]="currentPath.title"
          name="title"
          placeholder="Title"
          required
          #title="ngModel"
          (keydown)="onKeyDown($event)"
        />

        <textarea
          [(ngModel)]="currentPath.description"
          name="description"
          placeholder="Description"
          rows="3"
          required>
        </textarea>

        <input
          type="text"
          [(ngModel)]="currentPath.estimatedHours"
          name="estimatedHours"
          placeholder="Estimated Hours"
          required
        />

        <input
          type="text"
          [(ngModel)]="currentPath.image"
          name="image"
          placeholder="Image URL"
        />

        <!-- Select Courses Section -->
        <div class="select-courses-section">
          <h4>Select Courses</h4>
          <div class="courses-selection-list">
            <div
              class="course-selection-item"
              *ngFor="let c of allCourses(); trackBy: trackById">
              <label>
                <input
                  type="checkbox"
                  [checked]="isCourseSelected(c.id)"
                  (change)="toggleCourseSelection(c.id)" />
                <div class="course-info-text">
                  <div class="course-title">{{ c.title }}</div>
                  <div class="course-details-text">{{ c.duration }}h, {{ c.theme }}</div>
                </div>
              </label>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="pathForm.invalid || isSaving()" class="save-btn">
            <span *ngIf="isSaving()">Saving...</span>
            <span *ngIf="!isSaving()">Save</span>
          </button>
          <button type="button" class="cancel-btn" (click)="cancel()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div *ngIf="toastMessage()" class="toast">{{ toastMessage() }}</div>
</div>